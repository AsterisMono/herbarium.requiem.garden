---
lastUpdated: 2026-01-17
slug: systemd-hrt-reminder
draft: false
---
## æœ‰å¤ªå¤šè¯è¦åƒäº†ï¼

åœ¨å¾€è¿”å‡ æ¬¡æ­¦æ±‰å…­è§’äº­ + å¤šæ¬¡é€šè¿‡éæ³•æ¸ é“è´­ç‰©ï¼ˆå˜˜ï¼‰åï¼ŒNoa ç›®å‰æ—¥å¸¸è¦è§„å¾‹æœç”¨çš„ä¸œè¥¿ å¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç§ï¼š

### HRT ç›¸å…³

- [è¯ºå¤å¤ï¼ˆEstrofemï¼‰](https://mtf.wiki/zh-cn/docs/medicine/estrogen/estradiol)ï¼Œæ¯æ—¥ 3 æ¬¡ï¼ˆ7:00/15:00/23:00ï¼‰ï¼Œå…± 6mg èˆŒä¸‹å«æœ
- [è‰²æ™®é¾™ï¼ˆAndrocurï¼‰](https://mtf.wiki/zh-cn/docs/medicine/antiandrogen/cyproterone)ï¼Œéš”æ—¥ 1 æ¬¡ï¼Œæ¯æ¬¡ 12.5mg

### ç²¾å“ç¥è¯

- [è‰é…¸è‰¾å¸è¥¿é…æ™®å…° ~~ï¼ˆé™†å³¥å¿«ä¹ç‰‡ï¼‰~~](https://zh.wikipedia.org/wiki/%E8%89%BE%E5%8F%B8%E8%A5%BF%E9%85%9E%E6%99%AE%E5%85%B0)ï¼Œæ¯æ—¥ 1 æ¬¡ï¼Œæ¯æ¬¡ 15mgï¼ˆ1.5 ç‰‡ï¼‰
- [åŠ³æ‹‰è¥¿æ³®ç‰‡](https://zh.wikipedia.org/zh-hans/%E5%8A%B3%E6%8B%89%E8%A5%BF%E6%B3%AE)ï¼Œæ¯æ—¥ 2 æ¬¡ï¼Œæ¯æ¬¡ 0.5mgï¼ˆ0.5 ç‰‡ï¼‰ã€‚~~ä¼šå“„æˆ‘ç¡è§‰ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆè¢«è¦æ±‚æ—©ä¸Šåƒ~~
- [ç±³æ°®å¹³ç‰‡](https://zh.wikipedia.org/wiki/%E7%B1%B3%E6%B0%AE%E5%B9%B3)ï¼Œè¿™ä¸ªè¢«å¼€äº†ä½†æ˜¯æš‚æ—¶æ²¡æœ‰åƒï¼Œä¸æƒ³ç»™è‚å¤ªå¤§è´Ÿæ‹…

### è¡¥å‰‚

- ç»´ç”Ÿç´  Bï¼Œæ¯æ—¥ 3 æ¬¡ï¼Œæ¯æ¬¡ 2 ç‰‡ã€‚æ®è¯´å¯ä»¥é˜²æ­¢è‰²æ™®é¾™å¯¼è‡´çš„æŠ‘éƒä½†æ˜¯æ„Ÿè§‰å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨
- ç»´ç”Ÿç´  Cï¼Œéšç¼˜åƒï¼Œä¿æŒä¸€å®šç¨‹åº¦çš„æŠµæŠ—åŠ›

:::caution

å†™åˆ°è¿™æˆ‘æš—æš—æäº†ä¸€æŠŠæ±—... ç…§è¿™æ ·åƒä¸‹å»åˆ°åº•è¿˜èƒ½æ´»å¤šä¹…ï¼Ÿ

:::

:::note

è¿™äº›è¯å„æœ‰å®ƒä»¬çš„è§’è‰²ï¼š

ğŸ©· Estrofemï¼ˆé›ŒäºŒé†‡ï¼‰ï¼šä½ èº«ä½“çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¸®ä½ æ„ç­‘ä½ æƒ³æˆä¸ºçš„æ ·å­ï¼Œæ˜¯æ¸©æŸ”çš„å¡‘å½¢é­”æ³•ã€‚

ğŸ©¶ Androcurï¼ˆé†‹é…¸ç¯ä¸™å­•é…®ï¼‰ï¼šä¸€å±‚å±éšœï¼Œå¸®ä½ æŒ¡ä½ä¸å±äºä½ çš„å£°éŸ³ã€‚

ğŸ©µ Escitalopramï¼ˆè‰é…¸è‰¾å¸è¥¿é…æ™®å…°ï¼‰ï¼šä¿®è¡¥å†…å¿ƒæ·±å¤„ç ´ç¢çš„ç¥ç»å›è·¯ï¼Œè®©ä½ æ…¢æ…¢æ‰¾å›é¢œè‰²å’ŒèŠ‚å¥ã€‚

ğŸ’¤ Lorazepamï¼ˆåŠ³æ‹‰è¥¿æ³®ï¼‰ï¼šåœ¨æœ€æ··ä¹±æœ€ç—›è‹¦çš„æ—¶åˆ»å®‰æŠšä½ çš„å°è¯ä»™ï¼Œè®©ä½ è‡³å°‘èƒ½ç¡ç€ä¸€ç‚¹ç‚¹ã€‚

:::

## è®°ä¸ä½è¦åƒä»€ä¹ˆè¯äº†ï¼

åœ¨æœ€å¼€å§‹åªæœ‰åƒè¯ºå’Œè‰²ï¼Œé æˆ‘è¿™é¢—å››è¶³æ¯›èŒ¸èŒ¸å°å‹ç”Ÿç‰©çš„å¤§è„‘å‹‰å¼ºè¿˜è®°å¾—ä½ä»€ä¹ˆæ—¶å€™åƒï¼ˆè™½ç„¶è‰²æ™®é¾™éš”å¤©ä¸€åƒè¿™ä¸ªäº‹æƒ…ä¹Ÿç®—ç»™æˆ‘å¸¦æ¥äº†å¾ˆå¤§å›°æ‰°å—¯...ï¼‰

ç›´åˆ°ä¸Šå‘¨å› ä¸ºç¡çœ ä¸¥é‡ä¸å®‰å®šè·‘å»å…­è§’äº­å¼€äº†æ›´å¤šçš„ç²¾å“ç¥è¯ï¼Œè¿™ä¸‹å½»åº•æ²¡æ³•é è„‘å­åšæœè¯ç®¡ç†äº†... æ¼æœçš„æ¬¡æ•°å¼€å§‹é€æ¸å¢åŠ ï¼Œå°¤å…¶æ˜¯è‰é…¸è‰¾å¸å’Œä¸‹åˆé‚£é¡¿è¯ºå¤å¤ç»å¸¸ä¼šå¿˜æ‰ï¼Œå¥½å‡ æ¬¡å·®ç‚¹è¢«è¿«é€€åŒ–æˆé›„æ€§ï¼ˆ

![[Pasted image 20260117145818.png]]

äºæ˜¯æƒ³è¦ä¸€ä¸ªå°å·¥å…·æé†’è‡ªå·±æŒ‰æ—¶åƒè¯ã€‚ä½†çœ‹äº†ä¸€åœˆåªæœ‰å¦‚ä¸‹å‡ ä¸ªæ–¹æ¡ˆï¼š

- é—¹é’Ÿï¼Œè¿™å¤ªåµäº†ã€‚*è€Œä¸”å®Œå…¨æ²¡æœ‰ä»ªå¼æ„Ÿ*
- è´´å°çº¸æ¡åˆ°æ˜¾ç¤ºå™¨ä¸Šã€‚*åˆšå¼€å§‹å¯èƒ½æœ‰ç”¨ï¼Œåˆ°åé¢ä¸€å®šä¼šè¢«æˆ‘æ— è§†*
- ã€Œæé†’äº‹é¡¹ã€æˆ–è€…ç±»ä¼¼çš„å¾…åŠç®¡ç†åº”ç”¨ã€‚*ä¼¼ä¹å¯¹è¿™ç§å¾ˆè§„å¾‹çš„äº‹ä»¶ä¸æ˜¯ç‰¹åˆ«å‹å¥½ï¼Ÿè€Œä¸”æˆ‘å¹³æ—¶å¾ˆå°‘çœ‹æ‰‹æœº*
- ä¸“é—¨çš„æœè¯æé†’ APPã€‚*å¥½ç”¨çš„æ”¶è´¹ï¼Œå…è´¹çš„ä¸å¥½ç”¨*

è¿™æ—¶çªç„¶æƒ³åˆ°ï¼šNoa åŸºæœ¬ä¸€æ•´å¤©éƒ½å¯¹ç€ç”µè„‘ã€‚é‚£ä¼šä¸ä¼šæœ‰åœ¨ç”µè„‘ä¸Šå‘é€æŒä¹…æé†’çš„åŠæ³•å‘¢ï¼Ÿ

### Crontab

ç¬¬ä¸€ç›´è§‰æ˜¯ Crontab å®šæ—¶ä»»åŠ¡ +`notify-send`ã€‚

å¯ Crontab åªèƒ½åœ¨ç³»ç»Ÿçº§åˆ«è®¾ç½®ï¼Œè€Œè¿™å°æœºå™¨ä¸Šçš„ [å…¶ä»–äºº](../lyra-and-noa/) æ˜¾ç„¶ä¸éœ€è¦ Noa åŒæ¬¾æœè¯æé†’... è™½ç„¶å¯ä»¥æŒ‡å®šç”¨æˆ·èº«ä»½è¿è¡Œï¼Œä½†ä¸ç®¡æ€æ · Crontab è®¾ç½®ä¹ŸåŠ¿å¿…è½å…¥ system çš„ scope è€Œé user scopeï¼Œéœ€è¦ä½¿ç”¨ NixOS Module ç®¡ç†è€Œä¸èƒ½ä½¿ç”¨ Home Module äº†ã€‚ä¸æ˜¯å¾ˆå–œæ¬¢ã€‚

### systemd.timer

é—®äº†ä¸‹ Lyra æœ‰æ²¡æœ‰å…¶ä»– user scope çš„å¯é€‰æ–¹æ¡ˆï¼š

![[Pasted image 20260117145754.png]]

:::note

systemd.timer æ˜¯ systemd æä¾›çš„å®šæ—¶ä»»åŠ¡æœºåˆ¶ï¼Œå®ƒå¯ä»¥åœ¨ç”¨æˆ·å±‚æˆ–ç³»ç»Ÿå±‚æ›¿ä»£ä¼ ç»Ÿçš„ cronã€‚

é€šè¿‡ä¸ºä¸€ä¸ª service å•å…ƒé…å¥—åˆ›å»ºä¸€ä¸ª .timer å•å…ƒï¼Œä½ å¯ä»¥è®¾ç½®åœ¨æŒ‡å®šæ—¶é—´å‘¨æœŸè‡ªåŠ¨è§¦å‘æŸä¸ªä»»åŠ¡ï¼Œæ¯”å¦‚æ¯å¤©å¼¹å‡ºä¸€æ¡é€šçŸ¥æˆ–è¿è¡Œä¸€ä¸ªè„šæœ¬ã€‚

ç›¸æ¯” cronï¼Œsystemd.timer æ”¯æŒè‡ªç„¶è¯­è¨€å¼çš„æ—¶é—´è¡¨è¾¾ï¼ˆå¦‚ OnCalendar=*-*-* 09:00 è¡¨ç¤ºæ¯å¤© 9 ç‚¹ï¼‰ï¼Œè¿˜èƒ½æ­é… Persistent=true å®ç°æ‰ç”µåè¡¥è·‘ä»»åŠ¡ï¼Œéå¸¸é€‚åˆç”¨æ¥åˆ›å»ºå®‰é™åˆå¯é çš„æé†’å™¨ã€‚

:::

## é‚£ä¹ˆæ¥å†™ä¸€ç‚¹ Nix å§

ä½œä¸ºä¸€ç”Ÿéƒ½åœ¨è¿½æ±‚ Pure å’Œ Reproducible çš„ Nix é­”æ€”å£¬ï¼Œæ‰‹å†™ systemd unit æ˜¯ä¸å¯èƒ½çš„ï¼ç»å¯¹ä¸å¯èƒ½ï¼

è¿™é‡Œå¯ä»¥ç”¨åˆ° home-manager æä¾›çš„ä¸¤ä¸ª configï¼š[`systemd.user.services`](https://home-manager-options.extranix.com/?query=systemd.user.services&release=release-25.05) å’Œ [`systemd.user.timers`](https://home-manager-options.extranix.com/?query=systemd.user.timers&release=release-25.05)ã€‚å®ƒä»¬çš„è¯­æ³•å’Œ systemd unit åŸç”Ÿè¯­æ³•åŸºæœ¬ä¸€è‡´ï¼Œå¹¶æ²¡æœ‰åšå¤ªå¤šçš„æ˜ å°„é­”æ”¹ï¼Œç›´æ¥å†™ config éƒ¨åˆ†å°±å¥½ã€‚

```nix
config = {
  systemd.user = {
    services = ?;
    timers = ?;
  };
};
```

è¿™é‡Œæœ‰ä¸¤ä¸ªé—®å·éœ€è¦å¡«ï¼Œå®ƒä»¬çš„å†…å®¹åº”è¯¥æ˜¯ç”± options çš„æœ€ç»ˆå–å€¼æ´¾ç”Ÿå‡ºæ¥çš„ã€‚options é‡Œåº”è¯¥æœ‰è¶³å¤Ÿçš„é€‰é¡¹å¯ä»¥é…ç½®å¤šä¸ªæé†’å®šæ—¶ï¼ŒåŒ…æ‹¬è®¾ç½®æé†’æ—¶é—´ã€å®šæ—¶è¦è§¦å‘çš„æé†’å†…å®¹ï¼ˆå‘½ä»¤ï¼‰ã€‚å…ˆå†™ä¸€ä¸ªç”Ÿæˆå™¨å ä½åœ¨è¿™é‡Œï¼š

```nix
config = {
  systemd.user = {
    services = generateSystemdServices cfg;
    timers = generateSystemdTimers cfg;
  };
};
```

ä¸‹é¢å®šä¹‰ä¸€ä¸‹ reminder optionsã€‚å†™æˆä¸€ä¸ª submoduleï¼Œè¿™æ ·å¯ä»¥åœ¨å¤–å±‚ option å®šä¹‰é‡Œç”¨ `type = with types; attrsOf (submodule reminderOpts)`ï¼ŒæŠŠ reminder option ç•Œé¢è®¾è®¡æˆä¸€ä¸ª attrsetã€‚

```nix
reminderOpts = _: {
  options = {
    OnCalendar = mkOption {
      example = [ "*-*-* 4:00:00" ];
      type = with types; listOf str;
    };
    ExecStart = mkOption {
      example = ''
        notify-send "Hello world!"
      '';
      type = types.str;
    };
  };
};
```

å¯¹åº”çš„å¤–å±‚ option å°±å¯ä»¥è¿™æ ·å†™ï¼š

```nix
options = {
  noa.reminders = mkOption {
    example = {
      "estrofem-intake" = {
        OnCalendar = [ "*-*-* 15:00:00" ];
        ExecStart = ''
          notify-send -u critical -i /home/cmiki/Pictures/estrofem.png "HRT Reminder" "Time for an estrofem intake"
        '';
      };
    };
    type = with types; attrsOf (submodule reminderOpts);
  };
};
```

æœ€åå°±æ˜¯ç¼–å†™ä¸¤ä¸ªç”Ÿæˆå™¨çš„å®ç°äº†ï¼Œå¯¹äº systemd çš„è¯­æ³•æ¥è¯´éš¾åº¦ä¸å¤§ï¼Œä½†æ˜¯è¦æ³¨æ„åˆ©ç”¨å¥½ `lib.attrset` é‡Œçš„è¾…åŠ©å‡½æ•°ï¼Œé¿å…èµ°å¼¯è·¯é€ è½®å­ã€‚

:::tip

Noa æ¯”è¾ƒå¸¸ç”¨çš„ lib å‡½æ•°ï¼š

- å¤„ç† attrset å’Œå­æ¨¡å—ï¼š`lib.attrValues`ï¼Œ`lib.mapAttrs`ï¼Œ`lib.mapAttrs'`ï¼Œ`lib.nameValuePair`ï¼Œ`lib.concatMapAttrs`ï¼ˆé…åˆè‡ªå·±å†™çš„ mergeï¼‰
- å¤„ç†å­—ç¬¦ä¸²ï¼š`lib.hasSuffix/Prefix`ï¼Œ`lib.removeSuffix/Prefix`ï¼Œ`lib.concatStringsSep`ï¼Œ `lib.concatLines`, `lib.splitString`
- Optional ç³»åˆ—ï¼š`lib.optionals`ï¼Œ`lib.optionalAttrs`ï¼Œ`lib.optionalString`
- åˆ—è¡¨ï¼š`lib.head`
- è°ƒè¯•ï¼š`lib.traceVal`

:::

```nix
generateSystemdServices =
  reminderAttrs:
  lib.mapAttrs' (
    name: value:
    lib.nameValuePair "reminder-${name}" {
      Unit = {
        Description = "Reminder service for ${name}";
      };
      Service = {
        Type = "oneshot";
        inherit (value) ExecStart;
      };
    }
  ) reminderAttrs;
```

```nix
generateSystemdTimers =
  reminderAttrs:
  lib.mapAttrs' (
    name: value:
    lib.nameValuePair "reminder-${name}" {
      Unit = {
        Description = "Reminder timer for ${name}";
      };
      Install = {
        WantedBy = [ "timers.target" ];
      };
      Timer = {
        inherit (value) OnCalendar;
      };
    }
  ) reminderAttrs;
```

è¿™é‡Œè¦æ³¨æ„ service å’Œ unit åº”å½“æ˜¯åŒåçš„ï¼Œè¿™æ ·å®ƒä»¬ä¼šè‡ªåŠ¨å…³è”ä¸Šï¼Œä¸éœ€è¦é¢å¤–åœ¨ timer ä¸­æŒ‡å®š `Unit`ã€‚

## å¯¼å…¥æ¨¡å—å’Œåº”ç”¨é…ç½®

æƒ³ä½¿ç”¨ `notify-send` å‘é€å¯çˆ±çš„æŒä¹…é€šçŸ¥ï¼

å› ä¸º Noa ç”¨çš„æ˜¯ Mako çš„é»˜è®¤é…ç½®ï¼Œé€šçŸ¥ä¸ä¼šè¶…æ—¶æ¶ˆå¤±ï¼Œåªè¦æˆ‘æ²¡ç‚¹æ‰å®ƒå°±ä¼šä¸€ç›´åœ¨å±å¹•å³ä¸Šè§’æŒ‚ç€ã€‚

åœ¨ home-manager é…ç½®é‡Œè¿™æ ·å†™ï¼š

```nix
let
  # æ¥è‡ª ã€Œç²¾ç¥æ±¡æŸ“ã€ è´´çº¸åŒ…
  getReminderIcon = filename: "${assetsPath}/reminder-icons/${filename}";
  notify-send = lib.getExe' pkgs.libnotify "notify-send";
in
{
  imports = [ ./options.nix ];

  noa.reminders = {
    "estrofem-intake" = {
      OnCalendar = [
        "*-*-* 07:00:00"
        "*-*-* 15:00:00"
        "*-*-* 23:00:00"
      ];
      ExecStart = ''
        ${notify-send} -u critical -i ${getReminderIcon "estrofem.png"} "HRT Reminder" "Time for an estrofem intake"
      '';
    };
  }
}
```

è¿™æ ·ä¸€ä¸ªèŒèŒçš„æ¡Œé¢å®šæ—¶é€šçŸ¥æé†’å°±åšå¥½å•¦ã€‚æ•ˆæœå¦‚ä¸‹ï¼š

![[Pasted image 20260117145831.png]]

æé†’æ•ˆæœè¿˜è›®ä¸é”™çš„ï¼Œç›®å‰æ˜¯å¼€å§‹ä½¿ç”¨å®ƒçš„ç¬¬äºŒå¤©ï¼Œå·²ç»æ•‘äº†æˆ‘ä¸¤æ¬¡ï¼ˆ

![[Pasted image 20260117145739.png]]

æ¨¡å—æºä»£ç å¯ä»¥å‚è€ƒè¿™é‡Œï¼š<https://github.com/AsterisMono/flake/tree/main/homeModules/apps/reminder>
